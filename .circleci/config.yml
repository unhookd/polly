workflows:
  version: 2
  build:
    jobs:
      - bootstrap

      - rspec:
          requires:
            - bootstrap

defaults: &defaults
  working_directory: /home/app/current
  environment: &environment_defaults
    CUSTOM: "settings"
  docker:
    - image: &build_image ubuntu:bionic-20180526

version: 2
jobs:
  bootstrap:
    <<: *defaults
    steps:
      - checkout

      - run:
          name: bootstrap
          command: |
            set -e

            bash bin/bootstrap.sh

  rspec:
    <<: *defaults
    steps:
      - checkout

      - run:
          name: rspec
          command: |
            set -e

            bundle install --path=vendor/bundle

            bundle exec rspec

            ./bin/polly version
