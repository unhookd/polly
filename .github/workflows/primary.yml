name: primary

on: [push]

jobs:

  build:
 
    runs-on: ubuntu-18.04
 
    steps:
    - uses: actions/checkout@v1
    - name: bootstrap
      run: |
        set -e

        #TODO: remove this hack when github actions virtual-environment is fixed
        sudo apt remove -y -f php7.3-fpm php7.2-fpm msodbcsql17

        sudo bash bin/bootstrap.sh

    - name: rspec
      run: |
        set -e

        bundle install --path=vendor/bundle

        bundle exec rspec

        ./bin/polly version
